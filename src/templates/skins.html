{% extends "base.html" %}

{% block head %}
<title>Skins disponibles</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
{% endblock %}

{% block body %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}
<h1 class="titulo-skins">Skins disponibles</h1>

<div class="skins-grid">

    {% for skin in skins %}
    <div class="skin-card">

        <!-- Imagen principal -->
        <img src="{{ url_for('static', filename='skins/' + skin.imagenes[0]) }}"
             class="skin-img"
             id="img-{{ skin.id }}"
             data-images="{{ ','.join(skin.imagenes) }}">

        <h3>{{ skin.nombre }}</h3>

        {% if skin.equipped %}
            <!-- â­ SKIN EQUIPADA â­ -->
            <p class="skin-price comprado" style="color:#d4a017; font-weight:bold;">
                â­ EQUIPADA
            </p>

        {% elif skin.comprada %}
            <!-- âœ” SKIN COMPRADA â€” PERMITE EQUIPAR -->
            <p class="skin-price comprado">âœ” Comprada</p>

            <form method="POST" action="{{ url_for('pet.equip_skin') }}">
                <input type="hidden" name="skin_id" value="{{ skin.id }}">
                <button class="btn-skin equipar">Equipar</button>
            </form>

        {% else %}
            <!-- ğŸ’° SKIN SIN COMPRAR -->
            <p class="skin-price">ğŸ’° {{ skin.precio }} monedas</p>

            <form method="POST" action="{{ url_for('pet.buy_skin') }}">
                <input type="hidden" name="skin_id" value="{{ skin.id }}">
                <button class="btn-skin comprar">Comprar</button>
            </form>

        {% endif %}

    </div>
    {% endfor %}

</div>

<!-- AnimaciÃ³n hover -->
<script>
const timers = {};

document.querySelectorAll(".skin-img").forEach(img => {
    const id = img.id;
    const images = img.dataset.images.split(",");
    let index = 0;

    img.addEventListener("mouseover", () => {
        timers[id] = setInterval(() => {
            index = (index + 1) % images.length;
            img.src = "/static/skins/" + images[index];
        }, 500);
    });

    img.addEventListener("mouseout", () => {
        clearInterval(timers[id]);
        img.src = "/static/skins/" + images[0];
        index = 0;
    });
});
</script>

{% endblock %}
